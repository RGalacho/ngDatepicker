angular.module("rgalacho.translate-datepicker",["pascalprecht.translate"]).directive("ngDatepicker",["$rootScope","$document","$translate",function(e,a,n){"use strict";var t=function(){return n.use().replace(/([a-z]{2})(?:_[A-Z]{2})?/,"$1")},l=function(e,a){e.format=a.format||"YYYY-MM-DD",e.viewFormat=a.viewFormat||"Do MMMM YYYY",e.locale=a.locale||t()||"es",e.firstWeekDaySunday=e.$eval(a.firstWeekDaySunday)||!1,e.placeholder=a.placeholder||"",e.tooltip=a.tooltip||""};return{restrict:"EA",require:"?ngModel",scope:{},link:function(n,r,d,o){l(n,d),n.calendarOpened=!1,n.days=[],n.dayNames=null,n.viewValue=null,n.dateValue=null,moment.locale(n.locale);var i=moment(),c=i.clone(),s=function(){var e=moment(n.firstWeekDaySunday===!0?"2015-06-07":"2015-06-01");n.dayNames=new Array;for(var a=0;7>a;a+=1)n.dayNames.push(e.format("ddd")),e.add("1","d")},u=function(e,a){var t=e.endOf("month").date(),l=e.month(),r=e.year(),d=a.year()==e.year()&&a.month()==e.month(),o=1,i=n.firstWeekDaySunday===!0?e.set("date",2).day():e.set("date",1).day();1!==i&&(o-=i-1),n.dateValue=e.format("MMMM YYYY"),n.days=[];for(var c=o;t>=c;c+=1)n.days.push(c>0?{day:c,month:l+1,year:r,enabled:!0,selected:d&&a.date()==c}:{day:null,month:null,year:null,enabled:!1,selected:!1});s()},f=function(e){c.date(e.day),c.month(e.month-1),c.year(e.year)};n.showCalendar=function(){n.calendarOpened=!0,u(i,c)},n.closeCalendar=function(){n.calendarOpened=!1},n.prevYear=function(){i.subtract(1,"Y"),u(i,c)},n.prevMonth=function(){i.subtract(1,"M"),u(i,c)},n.nextMonth=function(){i.add(1,"M"),u(i,c)},n.nextYear=function(){i.add(1,"Y"),u(i,c)},n.selectDate=function(e,a){e.preventDefault(),f(a),o.$setViewValue(c.format(n.format)),n.viewValue=c.format(n.viewFormat),n.closeCalendar()};var p=["ng-datepicker","ng-datepicker-input"];void 0!==d.id&&p.push(d.id),a.on("click",function(e){if(n.calendarOpened){var a,t=0;if(e.target){for(a=e.target;a;a=a.parentNode){var l=a.id,r=a.className;if(void 0!==l)for(t=0;t<p.length;t+=1)if(l.indexOf(p[t])>-1||r.indexOf(p[t])>-1)return}n.closeCalendar(),n.$apply()}}}),e.$on("$translateChangeSuccess",function(){n.locale=t(),moment.locale(n.locale),i.locale(n.locale),o.$setViewValue(c.format(n.format)),n.viewValue=c.format(n.viewFormat)}),o.$render=function(){var e=o.$viewValue;n.viewValue=moment(e).format(d.viewFormat),n.dateValue=e}},template:'<div><input type="text" ng-focus="showCalendar()" ng-value="viewValue" class="input-sm ng-datepicker-input" placeholder="{{ placeholder }} tooltip={{ tooltip }}"></div><div class="ng-datepicker" ng-show="calendarOpened">  <div class="controls">    <div class="left">      <i class="fa fa-backward prev-year-btn" ng-click="prevYear()"></i>      <i class="fa fa-angle-left prev-month-btn" ng-click="prevMonth()"></i>    </div>    <span class="date" ng-bind="dateValue"></span>    <div class="right">      <i class="fa fa-angle-right next-month-btn" ng-click="nextMonth()"></i>      <i class="fa fa-forward next-year-btn" ng-click="nextYear()"></i>    </div>  </div>  <div class="day-names">    <span ng-repeat="dn in dayNames">      <span>{{ dn }}</span>    </span>  </div>  <div class="calendar">    <span ng-repeat="d in days">      <span class="day" ng-click="selectDate($event, d)" ng-class="{disabled: !d.enabled, selected: d.selected}">{{ d.day }}</span>    </span>  </div></div>'}}]);
